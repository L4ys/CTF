#include <stdio.h>

unsigned char code[121] = {
	0x33, 0xe1, 0xc4, 0x99, 0x11, 0x06, 0x81, 0x16, 0xf0, 0x32, 0x9f, 0xc4, 0x91, 0x17, 0x06, 0x81,
	0x14, 0xf0, 0x06, 0x81, 0x15, 0xf1, 0xc4, 0x91, 0x1a, 0x06, 0x81, 0x1b, 0xe2, 0x06, 0x81, 0x18,
	0xf2, 0x06, 0x81, 0x19, 0xf1, 0x06, 0x81, 0x1e, 0xf0, 0xc4, 0x99, 0x1f, 0xc4, 0x91, 0x1c, 0x06,
	0x81, 0x1d, 0xe6, 0x06, 0x81, 0x62, 0xef, 0x06, 0x81, 0x63, 0xf2, 0x06, 0x81, 0x60, 0xe3, 0xc4,
	0x99, 0x61, 0x06, 0x81, 0x66, 0xbc, 0x06, 0x81, 0x67, 0xe6, 0x06, 0x81, 0x64, 0xe8, 0x06, 0x81,
	0x65, 0x9d, 0x06, 0x81, 0x6a, 0xf2, 0xc4, 0x99, 0x6b, 0x06, 0x81, 0x68, 0xa9, 0x06, 0x81, 0x69,
	0xef, 0x06, 0x81, 0x6e, 0xee, 0x06, 0x81, 0x6f, 0xae, 0x06, 0x81, 0x6c, 0xe3, 0x06, 0x81, 0x6d,
	0xef, 0x06, 0x81, 0x72, 0xe9, 0x06, 0x81, 0x73, 0x7c
};

unsigned short hash(unsigned char *code, unsigned int len)
{
  unsigned short v3; // cx@1
  unsigned char *v4; // ebx@2
  unsigned short v5; // di@3
  signed int v6; // esi@3
  unsigned short v8; // [sp+0h] [bp-4h]@1

  v3 = 255;
  v8 = 255;
  if ( len ) {
    v4 = code;
    do {
      v5 = v8;
      v6 = len;
      if ( len > 20 )
        v6 = 20;
      len -= v6;
      do {
        v5 += *v4;
        v3 += v5;
        ++v4;
        --v6;
      }
      while ( v6 );
      v8 = (v5 >> 8) + (v5 & 0xff);
      v3 = (v3 >> 8) + (v3 & 0xff);
    }
    while ( len );
  }
  return ((v8 >> 8) + (v8 & 0xff)) | ((v3 << 8) + (v3 & 0xFF00));
}

int main(int argc, char *argv[])
{
	for ( int i = 0; i < 256; ++i ) {
		unsigned char buf[121] = {0};
		for ( int j = 0; j < 121; ++j ) {
			buf[j] = (code[j] ^ i) + 34;
		}
		if ( hash(buf, 121) == 0xFB5E ) {
			printf("found key: %x\n", i);
			break;
		}
	}
	return 0;
}

//et_tu_brute_force@flare-on.com

